# Monitoramento DistribuÃ­do com Prometheus, Thanos e Grafana

## ğŸ” VisÃ£o Geral  
Este repositÃ³rio oferece um exemplo de uma **soluÃ§Ã£o completa de monitoramento distribuÃ­do** para ambientes com mÃºltiplos sites e tenants. O sistema coleta mÃ©tricas de infraestrutura e serviÃ§os de contÃªineres e bancos de dados, com **retenÃ§Ã£o histÃ³rica de 15 dias**, **compactaÃ§Ã£o eficiente** e **alertas em tempo real via Telegram / Grafana**.

## ğŸ§© Tecnologias e Componentes  

- **Prometheus** â€” coleta de mÃ©tricas via exporters (Node Exporter, cAdvisor, Redis Exporter, Mongo Exporter).  
- **Exporters** â€” para hardware, contÃªineres Docker, Redis e MongoDB.  
- **Thanos** â€” para armazenamento de longo prazo, compactaÃ§Ã£o e agregaÃ§Ã£o centralizada.  
- **Grafana** â€” visualizaÃ§Ã£o das mÃ©tricas e dashboards.  
- **MinIO** â€” storage de objetos usado como backend pelo Thanos.  
- Suporte a mÃºltiplos â€œedgesâ€ (servidores locais) e um nÃ³ â€œcentralâ€ para agregaÃ§Ã£o.  

## ğŸ“¦ Arquitetura  

```
[Exporters] â†’ [Prometheus Edge (scrape local)]  
                   â†“ remote_write  
             [Thanos Receive] â†’ [MinIO + Thanos Store/Compactor/Sidecar]  
                                       â†‘  
                                 [Prometheus Central] â†’ [Grafana (dashboards + alertas)]  
```  

- InstÃ¢ncias â€œedgeâ€ espalhadas por site/tenant fazem scraping local das mÃ©tricas.  
- Dados enviados ao nÃ³ central via `remote_write`.  
- No central: Thanos + MinIO armazenam e compactam os dados.  
- Grafana consulta os dados centralizados, permitindo dashboards agregados por site ou tenant.  
- A utilizaÃ§Ã£o de labels (ex: site, tenant) permite segmentaÃ§Ã£o e filtragem de mÃ©tricas.  

## âœ… BenefÃ­cios  

- Monitoramento unificado de mÃºltiplos sites/tenants.  
- RetenÃ§Ã£o de histÃ³rico e possibilidade de anÃ¡lise no longo prazo.  
- ReduÃ§Ã£o de downtime potencial (~ 40%) graÃ§as a alertas e visibilidade proativa.  
- SegmentaÃ§Ã£o por labels â€” ideal para ambientes corporativos / multi-cliente.  
- Scripts de automaÃ§Ã£o (bash) para hardening e verificaÃ§Ãµes periÃ³dicas, facilitando deploy e manutenÃ§Ã£o.  

## ğŸ§° Requisitos  

- Docker & Docker Compose (versÃ£o 3.8 ou superior).  
- Sistema Ubuntu 20.04+ (ou equivalente compatÃ­vel).  
- Arquivo `.env` com variÃ¡veis de ambiente necessÃ¡rias (ex.: `MINIO_ROOT_USER`, `TELEGRAM_BOT_TOKEN`, etc.).  
- Acesso Ã s instÃ¢ncias de Redis e MongoDB que vocÃª deseja monitorar (para configurar os exporters correspondentes).  

## ğŸš€ InstalaÃ§Ã£o e ExecuÃ§Ã£o  

1. Clone este repositÃ³rio:  
   ```bash
   git clone https://github.com/MWismeck/monitoring-devops-stack.git
   cd monitoring-devops-stack
   ```  
2. Crie um arquivo `.env` com suas variÃ¡veis de ambiente (MinIO, Telegram, etc.).  
3. Configure os exporters (Node, cAdvisor, Redis, Mongo) nos servidores â€œedgeâ€.  
4. No nÃ³ central, execute:  
   ```bash
   docker compose up -d
   ```  
5. Acesse o painel do Grafana e importe dashboards prÃ©-configurados ou crie os seus.  
6. Verifique se os dados estÃ£o sendo enviados corretamente via `remote_write` e armazenados no Thanos + MinIO.  

## âš™ï¸ Funcionamento  

- Cada servidor â€œedgeâ€ executa exporters + Prometheus local para coleta das mÃ©tricas.  
- Os dados coletados sÃ£o enviados via `remote_write` para o central.  
- No central, o Thanos + MinIO armazenam e compactam os dados.  
- O Grafana consome os dados do Thanos ou Prometheus Central, permitindo dashboards globais ou por site/tenant.  
- Regras de alertas podem ser configuradas para disparo de notificaÃ§Ãµes (ex.: via Telegram).  

## ğŸ“ Estrutura de Pastas (exemplo)  

```
/
â”œâ”€â”€ docker-compose.yml        # define serviÃ§os centrais (MinIO, Thanos, Prometheus Central, Grafana)  
â”œâ”€â”€ .env                      # variÃ¡veis de ambiente necessÃ¡rias  
â”œâ”€â”€ exporters/                # exemplos/configuraÃ§Ãµes dos exporters (Node, cAdvisor, Redis, Mongo)  
â”œâ”€â”€ docs/                     # documentaÃ§Ã£o adicional, diagramas, guias de uso  
â””â”€â”€ README.md                 # este arquivo  
```  

## ğŸ‘¥ ContribuiÃ§Ãµes  

ContribuiÃ§Ãµes sÃ£o bem-vindas! Se quiser sugerir melhorias, adaptar para outros cenÃ¡rios ou adicionar funcionalidades â€” abra uma Issue ou um Pull Request.  

## ğŸ“„ LicenÃ§a  

Este projeto estÃ¡ licenciado sob a licenÃ§a **MIT** â€” sinta-se livre para usar, modificar e distribuir.  
